<!DOCTYPE html>
const safeBase = baseDist || 1; // avoid division by 0
const newScale = clamp((newDistRaw / safeBase) * baseScale, minScale, maxScale);


// Zoom around the midpoint
const midX = (a.clientX + b.clientX) / 2; const midY = (a.clientY + b.clientY) / 2;
const dx = midX - window.innerWidth / 2; const dy = midY - window.innerHeight / 2;
const scaleDelta = newScale - scale;
tx -= dx * scaleDelta / Math.max(newScale, 0.0001);
ty -= dy * scaleDelta / Math.max(newScale, 0.0001);
scale = newScale; applyTransform();
} else if (pointers.size === 1 && scale > 1) {
// Pan when zoomed
const dx = e.clientX - prev.clientX; const dy = e.clientY - prev.clientY;
tx += dx; ty += dy; applyTransform();
}
});


lbStage.addEventListener('pointerup', (e) => { pointers.delete(e.pointerId); });
lbStage.addEventListener('pointercancel', (e) => { pointers.delete(e.pointerId); });


// Double click / double tap to toggle zoom
let lastTap = 0;
lbStage.addEventListener('click', (e) => {
const now = Date.now();
if (now - lastTap < 300) {
// Toggle between 1 and 2x centered on click
const targetScale = scale > 1 ? 1 : 2;
const rect = lbStage.getBoundingClientRect();
const cx = e.clientX - (rect.left + rect.width / 2);
const cy = e.clientY - (rect.top + rect.height / 2);
tx -= cx * (targetScale - scale) / targetScale;
ty -= cy * (targetScale - scale) / targetScale;
scale = targetScale; applyTransform();
}
lastTap = now;
});


// Reset transform when navigating
[lbNext, lbPrev].forEach(btn => btn.addEventListener('click', resetTransform));
lb.addEventListener('wheel', (e) => {
if (!lb.classList.contains('open')) return;
e.preventDefault();
const delta = Math.sign(e.deltaY);
const targetScale = clamp(scale + (delta < 0 ? 0.15 : -0.15), minScale, maxScale);
const rect = lbStage.getBoundingClientRect();
const cx = e.clientX - (rect.left + rect.width / 2);
const cy = e.clientY - (rect.top + rect.height / 2);
tx -= cx * (targetScale - scale) / targetScale;
ty -= cy * (targetScale - scale) / targetScale;
scale = targetScale; applyTransform();
}, { passive: false });
})();
</script>
</body>
</html>
